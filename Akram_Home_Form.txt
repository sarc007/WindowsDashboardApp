using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Linq;
using System.Threading.Tasks;
using System.Windows.Forms;
using DevExpress.XtraEditors;
using MySql.Data.MySqlClient;

namespace WindowsDashboardApp
{
    public partial class Home_New : DevExpress.XtraEditors.XtraForm
    {
        public Home_New()
        {
            InitializeComponent();
        }

        public void DbConnect()
        {
            DbConnection dbCon = new DbConnection();
            string connetionString = dbCon.getConnection();
            MySqlConnection cnn = new MySqlConnection(connetionString);
            MySqlDataReader row, row2;
            MySqlCommand cmd = new MySqlCommand();
            cnn.Open();
        }

        public void Home_New_Load(object sender, EventArgs e)
        {
            var gbm_iva_id = 0;
            DbConnection dbCon = new DbConnection();
            string connetionString = dbCon.getConnection();
            MySqlConnection cnn = new MySqlConnection(connetionString);
            MySqlDataReader row, row2;
            MySqlCommand cmd = new MySqlCommand();
            cnn.Open();
            sites_CheckBox.Items.Add("SELECT ALL", true);
            camera_checkbox.Items.Add("SELECT ALL", true);

            string get_gbm_iva_id = "SELECT ID FROM gbm_iva where Name = '" + GBMIVA.Home_New + "';";
            //MessageBox.Show(get_gbm_iva_id);
            cmd = new MySqlCommand(get_gbm_iva_id, cnn);
            row = cmd.ExecuteReader();
            while (row.Read())
            {
                gbm_iva_id = Convert.ToInt32(row["ID"].ToString());
                //MessageBox.Show(gbm_iva_id.ToString());
            }
            row.Close();

            string query = "SELECT * FROM configuration_type_tbl WHERE fk_gbm_iva_id = " + gbm_iva_id + " and active_fld = 1;";
            //MessageBox.Show(query);
            cmd = new MySqlCommand(query, cnn);
            row = cmd.ExecuteReader();
            var count_of_records = 0;
            var Sub_Cases = "";
            List<string> cases = new List<string>();
            List<string> images = new List<string>();
            List<int> config_type_id = new List<int>();

            while (row.Read())
            {
                string col1Value = row["configuration_description_fld"].ToString();
                //string col2Value = row["image_path"].ToString();
                cases.Add(col1Value);
                //MessageBox.Show(col1Value);
                //images.Add(col2Value);
                //MessageBox.Show(col2Value);
                config_type_id.Add(Convert.ToInt32(row["ID"]));
                count_of_records += 1;
            }
            row.Close();

            for(int j =0; j < cases.Count; j++)
            {
                sub_Cases_CheckedComboBox.Properties.PopupFormSize = new Size(200, 200);
                Sub_Cases = sub_Cases_CheckedComboBox.Properties.Items.Add(cases[j]).ToString();
                
                string get_conf_id_query = "SELECT ID FROM configuration_type_tbl WHERE configuration_description_fld = '" + cases[j] + "';";
                MessageBox.Show(get_conf_id_query);
                cmd = new MySqlCommand(get_conf_id_query, cnn);
                row = cmd.ExecuteReader();

                List<int> conf_id = new List<int>();
                while (row.Read())
                {
                    conf_id.Add(Convert.ToInt32(row["ID"]));
                }
                row.Close();

                for (int k = 0; k < conf_id.Count; k++)
                {
                    string get_sites = "SELECT * FROM configuration_tbl WHERE config_type_id = '" + conf_id[k] + "';";
                    cmd = new MySqlCommand(get_sites, cnn);
                    row = cmd.ExecuteReader();

                    List<string> conf_desc_list = new List<string>();
                    List<string> conf_id_list = new List<string>();
                    while (row.Read())
                    {
                        conf_desc_list.Add(row["configuaration_description_fld"].ToString());
                        conf_id_list.Add(row["ID"].ToString());
                    }
                    row.Close();

                    for (int a = 0; a < conf_id_list.Count; a++)
                    {
                        sites_CheckBox.Items.Add(conf_desc_list[a], false);
                    }

                    for (int l = 0; l < conf_id_list.Count; l++)
                    {
                        string get_cameras = "SELECT * FROM camera_configuration_tbl WHERE config_id_fld = '" +conf_id_list[l]+ "';";
                        //MessageBox.Show(get_cameras);
                        cmd = new MySqlCommand(get_cameras, cnn);
                        row = cmd.ExecuteReader();

                        List<int> camera_id_list = new List<int>();
                        List<string> camera_ip_list = new List<string>();
                        List<string> camera_port_list = new List<string>();
                        List<string> camera_user_list = new List<string>();
                        List<string> camera_pwd_list = new List<string>();

                        while (row.Read())
                        {
                            camera_id_list.Add(Convert.ToInt32(row["ID"]));
                            camera_ip_list.Add(row["camera_ip_fid"].ToString());
                            camera_port_list.Add(row["camera_port_no_fid"].ToString());
                            camera_user_list.Add(row["camera_user_id"].ToString());
                            camera_pwd_list.Add(row["camera_password_fid"].ToString());
                        }
                        row.Close();

                        for (int b = 0; b < camera_ip_list.Count; b++)
                        {
                            camera_checkbox.Items.Add(camera_ip_list[b] + " - " + camera_port_list[b], false);
                        }
                    }
                }
            }
            sub_Cases_CheckedComboBox.CheckAll();
        }

        private void sub_Cases_CheckedComboBox_ButtonClick(object sender, DevExpress.XtraEditors.Controls.ButtonPressedEventArgs e)
        {
            //MessageBox.Show("test");
        }

        private void sub_Cases_CheckedComboBox_Properties_EditValueChanged(object sender, EventArgs e)
        {
            DbConnect();
            

            //MessageBox.Show("Hii");
            //Console.WriteLine(sub_Cases_CheckedComboBox.Text);
            

            getAllSite(sub_Cases_CheckedComboBox.Text);
        }

        private void getAllSite(string text)
        {
            DbConnection dbCon = new DbConnection();
            string connetionString = dbCon.getConnection();
            MySqlConnection cnn = new MySqlConnection(connetionString);
            MySqlDataReader row, row2;
            MySqlCommand cmd = new MySqlCommand();
            cnn.Open();

            string[] arraySite = text.Split(',');
            string sites = sub_Cases_CheckedComboBox.ToString();
            //MessageBox.Show(sites);

            string select_site = "SELECT * FROM configuration_tbl WHERE config_type_id = '" + sites + "';";
            //MessageBox.Show(select_site);
            //string select_site = "SELECT * FROM configuration_tbl";
            cmd = new MySqlCommand(select_site, cnn);
            row2 = cmd.ExecuteReader();

            List<string> desc = new List<string>();
            List<string> config_tbl_id = new List<string>();

            while (row2.Read())
            {
                string desc_from_db = row2["configuaration_description_fld"].ToString();
                //string id_from_db = row2["ID"].ToString();
                desc.Add(desc_from_db);
                // config_tbl_id.Add(id_from_db);
            }

            for (int i = 0; i < desc.Count; i++)
            {
                sites_CheckBox.Items.AddRange(new object[] { (desc[i]) });
            }
            row2.Close();


        }

        private void hide_Click(object sender, EventArgs e)
        {
            //splitContainerControl1.Hide();
            //SplitContainerControl show = new SplitContainerControl();
            //show.Appearance.BackColor = System.Drawing.Color.DarkGray;
            //show.Appearance.Options.UseBackColor = true;
            //show.Location = new System.Drawing.Point(0, 0);
            //show.Name = "splitContainerControl2";
            //show.Panel1.BorderStyle = DevExpress.XtraEditors.Controls.BorderStyles.HotFlat;
            //show.Size = new Size(1815, 100);
            //show.SplitterPosition = 200;
            //show.Height = splitContainerControl1.Height;
            //Button showButton = new Button();
            //showButton.Text = "SHOW";
            //showButton.Location = new Point(1395, 10);
            //showButton.Size = new Size(124, 42);
            //showButton.UseVisualStyleBackColor = true;
            //showButton.Click += new EventHandler(this.show_click);
            //show.Panel2.Controls.Add(showButton);
            //this.Controls.Add(show);
        }

        private void show_click(object sender, EventArgs e)
        {
            MessageBox.Show("HI");
        }
    }
}